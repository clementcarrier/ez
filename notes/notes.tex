
\documentclass[11pt,oneside, a4paper]{amsart}
\usepackage{natbib}

\usepackage{amsbsy,amsmath}
\usepackage{amssymb,amsfonts}
\usepackage{bbm}%give 1 with dbl vertical bar 
\usepackage{booktabs,url,enumerate}
\usepackage{color,xcolor,colortbl}
\usepackage{float}
\usepackage{tikz}
\usepackage{rotating,graphicx,lscape}
\usepackage{commath}
\usetikzlibrary{arrows,positioning} 
\usepackage[hypcap]{caption}
\newcommand{\sgn}{\mathrm{sign}}
\usepackage{setspace}

% bold rows
\usepackage{array}
\newcolumntype{$}{>{\global\let\currentrowstyle\relax}}
\newcolumntype{^}{>{\currentrowstyle}}
\newcommand{\rowstyle}[1]{\gdef\currentrowstyle{#1}%
  #1\ignorespaces
}

% Invisible table columns!
\newcolumntype{H}{>{\setbox0=\hbox\bgroup}c<{\egroup}@{}}% Properly placed sideways table with asmart class. 

\setlength\rotFPtop{0pt plus 1fil} 


\usepackage[top=1.5cm, bottom=1.5cm, left=3.0cm, right=3.0cm]{geometry}

\DeclareMathOperator{\Med}{\mathbb{M}ed}
\DeclareMathOperator{\Mean}{\mathbb{M}ean}
\DeclareMathOperator{\Cov}{\mathbb{C}ov}
\DeclareMathOperator{\Var}{\mathbb{V}ar}
\DeclareMathOperator{\E}{\mathbb{E}}
\DeclareMathOperator{\nid}{NID}
\DeclareMathOperator{\N}{\mathcal{N}}
\DeclareMathOperator{\corr}{corr}
\DeclareMathOperator{\diag}{diag}
\onehalfspace


\definecolor{LightRed}{rgb}{1,.88,.88}
\definecolor{LightBlue}{rgb}{.88,.88,1}
\definecolor{LightGreen}{rgb}{.88,1,.88}

\newtheorem{theorem}{Theorem}
\usepackage{Sweave}
\begin{document}
\input{notes-concordance}
	
\title{Some notes on VAR models for the EZ.}   
\author{LAFC}
\date{\today}
\maketitle

Define a set of endogenous variables $Y_t=[y_{1t},...,y_{k_Y t}]$, $t=1,...,T$, and define a set of exogenous variables $X_t$ stored in vectors of dimension $1\times k_Y$ and $1\times k_X$, respectively. Note that $Y_t$ could be the first difference of some variables, I use this notation for the sake of generality. Let $D_t$ be the vector of deterministic components of the model. $D_t$ could contain an intercept, a linear trend, or dummies. Also define $Z_t'=[Y_{t-1}',...,Y_{t-p}',X_{t}',D_t']$. The main model we consider is a VARX(p) of the form
\begin{align}
 Y_t &= D_t^* + \sum_{l=1}^p  Y_{t-l}A_l^* + X_t B^* + \epsilon_t,\nonumber\\
    &= D_t^* + Z_t \Gamma^* + \epsilon_t^*,\nonumber\\
 y_{it}&= d_{it}^* + Z_{t} \gamma_i^* + \epsilon_{it}^*,\label{eq:var}
\end{align}
The parameter matrix $\Gamma^*$ is of dimensions $ k_Y \times \left(pk_Y+k_X (:=k) \right)$. The VAR is estimated equation-by-equation both to speed up computations and to adapt the penalty to the variance in each equation. A possible exception is if using the group Lasso for lag selection.   


\section*{Estimation}

\subsection*{Lasso}
The objective function of the Lasso is given by 
\begin{align}
L(\gamma_{i})=\frac{1}{T}\enVert{y_{i}-d_{it}-Z\gamma_{i}}^2+2\lambda_T\enVert{\gamma_{i}}_{\ell_1}\label{eq:obj}.
\end{align}

The model is estimated equation-by-equation and the penalty parameter is selected by BIC among those on the path selected by \texttt{glmnet}. \texttt{Lassovar} takes care of this part.  

\subsection*{Adaptive Lasso}

The objective function of the adaptive Lasso is given by 
\begin{align}
L(\gamma_{i})=\frac{1}{T}\enVert{y_{i}-d_{it}-Z\gamma_{i}}^2+2\lambda_T\sum_{j=1}^{k}w_{ij}\gamma_{ij}\label{eq:objada}.
\end{align}
where the adaptive weights can be given by $w_{ij}=\frac{1}{\hat\gamma_{ij}}$ where $\hat\gamma_{ij}$ is some initial estimator of $\gamma^*_{ij}$. If $\hat\gamma_{ij}=0$, variable $j$ is excluded from equation $i$ before estimating the adaptive Lasso. OLS or the Lasso are fine initial estimators, but they both have weaknesses. The risk of misclassification for the Lasso (excluding a relevant variable) and the poor quality of the estimates if $k$ is close to $T$.    



\section*{Shock response}

Consider a VAR(1) in difference where the parameters have been estimated:
\begin{align}
\Delta Y_t &= \Delta Y_{t-1} \hat A + \epsilon_t,\nonumber
\end{align}

To compute the response to an exogenous shock of size $s$ to the first variable in $Y$, construct the vector $\delta =[s,0,...,0]$. The response at after $h$ periods is given by $\delta \hat A^h$. 
\begin{itemize}
\item For models with multiple lags the companion form (or simply recursive computations) can be used.
\item For models with exogenous variables, at path for the exogenous variables has to be specified. In general it should be equal to zero or to a random walk forecast, at least in periods following an initial shock. 
\item The deterministics can be omitted. 
\item For VECM models, things are more complicated but not much more difficult.    
\end{itemize}


\section*{Conditional forecasts}

The options so far:
\begin{itemize}
\item Create a model for the exogenous variable. 
\item Use na\"{i}ve methods (i.e. RW).
\item Compute prediction density for the exogenous variable and plug in the model. Gaussian + linear = Gaussian.
\item Condition on true value. 
\end{itemize}



\section*{Some tests}


\begin{Schunk}
\begin{Sinput}
> library(lassovar)
> library(ggplot2)
> library(reshape2)
> load('../Result/vardata')
> # loadind and subseting the data
> dat <- data.frame(vardataframe[116:180, c(1,2,6,11,13,17,8,24) ])
> # differentiating
> difdat <- tail(dat,-1) - head(dat,-1)
> 
\end{Sinput}
\end{Schunk}

\begin{Schunk}
\begin{Sinput}
> # estimate a VAR(1)
> lv_lev<-lassovar(dat,lags=1, ic="BIC")
> summary(lv_lev)
\end{Sinput}
\begin{Soutput}
Call:
lassovar(dat = dat, lags = 1, ic = "BIC")

Model estimated equation by equation
Selection criterion: BIC
Estimator: Lasso
Dimensions: T = 64  N = 8

Total number of variables selected:26 (40.625% of candidates)
[1] "Model summary statistics:"
           Lambda non-zero    resid var
CPE   0.009137410        3 1.679413e-04
DJES  0.047738176        3 7.856802e+01
HICP  0.002310290        4 2.891006e-04
LTN   0.006771786        3 6.916725e-02
M3    0.014432675        3 1.286696e-03
POILU 0.037676144        4 2.943369e-01
LHO   0.018900280        1 1.011330e-03
YED   0.007223302        5 1.002183e-04
\end{Soutput}
\begin{Sinput}
> lv_lev_trend<-lassovar(dat,lags=1, ic="BIC",exo=seq(1:nrow(dat)))
> summary(lv_lev_trend)
\end{Sinput}
\begin{Soutput}
Call:
lassovar(dat = dat, exo = seq(1:nrow(dat)), lags = 1, ic = "BIC")

Model estimated equation by equation
Selection criterion: BIC
Estimator: Lasso
Dimensions: T = 64  N = 8

Total number of variables selected:30 (41.66667% of candidates)
[1] "Model summary statistics:"
           Lambda non-zero    resid var
CPE   0.009137410        4 1.667344e-04
DJES  0.052392590        4 7.243895e+01
HICP  0.002310290        5 2.821701e-04
LTN   0.006771786        3 6.916725e-02
M3    0.014432675        3 1.286696e-03
POILU 0.009332668        5 2.867100e-01
LHO   0.018900280        1 1.011330e-03
YED   0.007223302        5 1.002183e-04
\end{Soutput}
\begin{Sinput}
> lv_dif<-lassovar(difdat,lags=1, ic="BIC")
> summary(lv_dif)
\end{Sinput}
\begin{Soutput}
Call:
lassovar(dat = difdat, lags = 1, ic = "BIC")

Model estimated equation by equation
Selection criterion: BIC
Estimator: Lasso
Dimensions: T = 63  N = 8

Total number of variables selected:16 (25% of candidates)
[1] "Model summary statistics:"
            Lambda non-zero    resid var
CPE   0.0024551858        0 8.912461e-05
DJES  1.8958393270        2 8.264576e+01
HICP  0.0014289972        4 2.665823e-04
LTN   0.0778170470        0 8.896670e-02
M3    0.0009786965        6 8.803950e-04
POILU 0.1861160585        0 3.695596e-01
LHO   0.0029187219        2 2.666321e-04
YED   0.0014462239        2 4.939361e-05
\end{Soutput}
\begin{Sinput}
> 
\end{Sinput}
\end{Schunk}


\begin{Schunk}
\begin{Sinput}
> # printing the diagonal of the parameter matrix
> ar1 <- cbind(diag(coef(lv_lev)[-1,]),
+              diag(coef(lv_lev_trend)[2:(1+ncol(dat)),]),
+              diag(coef(lv_dif)[-1,]))
> rownames(ar1) <- lv_lev$var.names
> colnames(ar1) <- c('level','level + trend','diff')
> mar1 <- melt(ar1)
> ggplot(mar1,aes(x=Var1,y=value,colour=Var2,shape=Var2)) +
+   geom_point(size=3) + theme_minimal()
\end{Sinput}
\end{Schunk}


The parameters fo the VAR in level are pretty close to 1. The trend is usually set to zero by the Lasso. It should probably not be penalized anyway. In the model in difference, the estimator often does not select an equation's own lag in most cases. weird. 


\end{document}
